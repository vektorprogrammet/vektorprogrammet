{% extends 'base_new.html.twig' %}

{% block title %}Utlegg{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset_with_version('css/pages/my_receipts.css') }}">
{% endblock %}

{% block body %}
    <section class="row">
        <div class="container">
            <div class="page-header">
                <h1>Utlegg</h1>
                <p>
                    Her kan du registrere utlegg du har gjort for vektorprogrammet som du ønsker å få refundert. For å få refusjon
                    må du laste opp en kvittering som bekrefter utlegget ditt.
                </p>
            </div>
            <div>
                <h3 class="text-center">Hva kan jeg få refundert?</h3>
                <p>
                    {% if is_granted_team_member() %}
                        Du kan typisk få refusjon for bussbilletter til og fra skole, kaffeposer til stand, kake til arrangementer og lignende. Det er ellers
                        lurt å høre med en leder om du kan få utlegget ditt refundert før du legger ut.
                    {% else %}
                        Vi refunderer gjerne bussbilletter o.l. til og fra skolene. Hvis du har tenkt til å legge ut for noe annet kan det være lurt å
                        høre med en leder om du kan få det refundert først.
                    {% endif %}
                    Om du har spørsmål kan du kontakte økonomiteamet på <a href="mailto:okonomi@vektorprogrammet.no">okonomi@vektorprogrammet.no</a>.
                </p>
            </div>
            {% for flashMessage in app.session.flashbag.get('success') %}
            <div data-alert class="alert alert-success">
                {{ flashMessage }}
            </div>
            {% endfor %}
        </div>
    </section>

    <section class="row" id="receipt-form">
        <div class="container">
            <h3> Registrer nytt utlegg </h3>
            {% include 'receipt/create_receipt.html.twig' with {'form': form, 'receipt': receipt} %}
        </div>
    </section>

    <div class="row">

        <div class="small-12 medium-12 large-12 columns">
            <hr>
        </div>

        <div class="small-12 columns">

            <h3>Mine utlegg</h3>
            <a href="#receipt-form" class="text-success" onclick="toggleForm()"><i class="fa fa-plus"></i> Nytt utlegg</a>
            {% if app.user.accountNumber %}
                <span class="float-right">Kontonummer: {{ app.user.accountNumber }}</span>
            {% endif %}

        </div>
    </div>
    <div class="row">
        <div class="small-12 medium-12 large-12 columns">

            <br>

            {% if receipts %}
            <div class="table-responsive">
                {% include 'receipt/my_receipts_table.html.twig' with {'receipts': receipts} %}
            </div>
            {% endif %}

        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
        function toggleForm() {
          $('#receipt-form').slideDown();
        }
    </script>
    <script>
        function readURL(input) {

            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $('#receipt_picture').attr('src', e.target.result);
                };

                reader.readAsDataURL(input.files[0]);
            }
        }

        $("#receipt_picturePath").change(function () {
            if(this.value === ''){
                $('#receipt_picture').parent().addClass('hide');
            } else {
                $('#receipt_picture').parent().removeClass('hide');
                readURL(this);
            }
        });

    </script>

    <script>
        setTimeout(function () {
            $('.alert-box').fadeOut(800);
        }, 1500)
    </script>

    <script src="{{ asset_with_version('js/bankAccountNumberValidation.js') }}"></script>
{% endblock %}
